+ CEPH_SECRET_FILE=
+ CEPH_ID=admin
+ SECRET_ARGS=
+ '[' '!' -z ']'
+ TMP_FILES='/tmp/img1 /tmp/img1.small /tmp/img1.snap1 /tmp/img1.export /tmp/img1.trunc'
+ clean_up
+ '[' -e /dev/rbd/rbd/testimg1@snap1 ']'
+ '[' -e /dev/rbd/rbd/testimg1 ']'
+ rbd ls
+ grep testimg1
+ true
+ sudo rm -f /tmp/img1 /tmp/img1.small /tmp/img1.snap1 /tmp/img1.export /tmp/img1.trunc
+ trap clean_up INT TERM EXIT
+ dd if=/bin/sh of=/tmp/img1 bs=1k count=1 seek=10
记录了1+0 的读入
记录了1+0 的写出
1024 bytes (1.0 kB, 1.0 KiB) copied, 0.000260941 s, 3.9 MB/s
+ dd if=/bin/dd of=/tmp/img1 bs=1k count=10 seek=100
记录了10+0 的读入
记录了10+0 的写出
10240 bytes (10 kB, 10 KiB) copied, 0.000299041 s, 34.2 MB/s
+ dd if=/bin/rm of=/tmp/img1 bs=1k count=100 seek=1000
记录了50+1 的读入
记录了50+1 的写出
51880 bytes (52 kB, 51 KiB) copied, 0.000543962 s, 95.4 MB/s
+ dd if=/bin/ls of=/tmp/img1 bs=1k seek=10000
记录了115+1 的读入
记录了115+1 的写出
118184 bytes (118 kB, 115 KiB) copied, 0.000962502 s, 123 MB/s
+ dd if=/bin/ln of=/tmp/img1 bs=1k seek=100000
记录了46+1 的读入
记录了46+1 的写出
47784 bytes (48 kB, 47 KiB) copied, 0.000496041 s, 96.3 MB/s
+ dd if=/dev/zero of=/tmp/img1 count=0 seek=150000
记录了0+0 的读入
记录了0+0 的写出
0 bytes copied, 0.000236521 s, 0.0 kB/s
+ rbd import /tmp/img1 testimg1
Importing image: 5% complete...Importing image: 10% complete...Importing image: 16% complete...Importing image: 21% complete...Importing image: 27% complete...Importing image: 32% complete...Importing image: 38% complete...Importing image: 43% complete...Importing image: 49% complete...Importing image: 54% complete...Importing image: 60% complete...Importing image: 65% complete...Importing image: 70% complete...Importing image: 76% complete...Importing image: 81% complete...Importing image: 87% complete...Importing image: 92% complete...Importing image: 98% complete...Importing image: 100% complete...done.
+ sudo rbd map testimg1 --user admin
rbd: sysfs write failed
In some cases useful info is found in syslog - try "dmesg | tail" or so.
rbd: map failed: (110) Connection timed out
+ clean_up
+ '[' -e /dev/rbd/rbd/testimg1@snap1 ']'
+ '[' -e /dev/rbd/rbd/testimg1 ']'
+ grep testimg1
+ rbd ls
+ rbd rm testimg1
Removing image: 5% complete...Removing image: 10% complete...Removing image: 15% complete...Removing image: 21% complete...Removing image: 26% complete...Removing image: 31% complete...Removing image: 36% complete...Removing image: 42% complete...Removing image: 47% complete...Removing image: 52% complete...Removing image: 57% complete...Removing image: 63% complete...Removing image: 68% complete...Removing image: 73% complete...Removing image: 78% complete...Removing image: 84% complete...Removing image: 89% complete...Removing image: 94% complete...Removing image: 100% complete...done.
+ sudo rm -f /tmp/img1 /tmp/img1.small /tmp/img1.snap1 /tmp/img1.export /tmp/img1.trunc
