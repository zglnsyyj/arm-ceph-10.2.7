-:1.3351: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_journal
+ local image=testrbdjournal3311723
+ rbd create --image-feature exclusive-lock --image-feature journaling --size 128 testrbdjournal3311723
++ xmlstarlet sel -t -v //image/journal
++ rbd info testrbdjournal3311723 --format=xml
+ local journal=130ec32ae8944a
+ test -n 130ec32ae8944a
+ rbd journal info 130ec32ae8944a
rbd journal '130ec32ae8944a':
	header_oid: journal.130ec32ae8944a
	object_oid_prefix: journal_data.0.130ec32ae8944a.
	order: 24 (16384 kB objects)
	splay_width: 4
+ rbd journal info --journal 130ec32ae8944a
rbd journal '130ec32ae8944a':
	header_oid: journal.130ec32ae8944a
	object_oid_prefix: journal_data.0.130ec32ae8944a.
	order: 24 (16384 kB objects)
	splay_width: 4
+ rbd journal info --image testrbdjournal3311723
rbd journal '130ec32ae8944a':
	header_oid: journal.130ec32ae8944a
	object_oid_prefix: journal_data.0.130ec32ae8944a.
	order: 24 (16384 kB objects)
	splay_width: 4
+ rbd feature disable testrbdjournal3311723 journaling
+ expect_false xmlstarlet sel -t -v //image/journal
+ set -x
+ xmlstarlet sel -t -v //image/journal
+ rbd info testrbdjournal3311723 --format=xml
+ return 0
+ expect_false rbd journal info 130ec32ae8944a
+ set -x
+ rbd journal info 130ec32ae8944a
failed to get journal metadata: (2) No such file or directory
rbd: journal info: (2) No such file or directory
+ return 0
+ expect_false rbd journal info --image testrbdjournal3311723
+ set -x
+ rbd journal info --image testrbdjournal3311723
rbd: journaling is not enabled for image testrbdjournal3311723
+ return 0
+ rbd feature enable testrbdjournal3311723 journaling
++ xmlstarlet sel -t -v //image/journal
++ rbd info testrbdjournal3311723 --format=xml
+ local journal1=130ec32ae8944a
+ test 130ec32ae8944a = 130ec32ae8944a
+ rbd journal info 130ec32ae8944a
rbd journal '130ec32ae8944a':
	header_oid: journal.130ec32ae8944a
	object_oid_prefix: journal_data.0.130ec32ae8944a.
	order: 24 (16384 kB objects)
	splay_width: 4
+ rbd journal status 130ec32ae8944a
minimum_set: 0
active_set: 0
registered clients: 
	[id=, commit_position=[positions=[]], state=connected]
+ local count=10
+ save_commit_position 130ec32ae8944a
+ local journal=130ec32ae8944a
+ rados -p rbd getomapval journal.130ec32ae8944a client_ /tmp/rbd_journal3311723/130ec32ae8944a.client_.omap
Writing to /tmp/rbd_journal3311723/130ec32ae8944a.client_.omap
+ rbd bench-write testrbdjournal3311723 --io-size 4096 --io-threads 1 --io-total 40960 --io-pattern seq
bench-write  io_size 4096 io_threads 1 bytes 40960 pattern sequential
  SEC       OPS   OPS/SEC   BYTES/SEC
elapsed:     0  ops:       10  ops/sec:    94.16  bytes/sec: 385697.91
+ fgrep tid=9
+ rbd journal status --image testrbdjournal3311723
	[id=, commit_position=[positions=[[object_number=1, tag_tid=1, entry_tid=9], [object_number=0, tag_tid=1, entry_tid=8], [object_number=3, tag_tid=1, entry_tid=7], [object_number=2, tag_tid=1, entry_tid=6]]], state=connected]
+ restore_commit_position 130ec32ae8944a
+ local journal=130ec32ae8944a
+ rados -p rbd setomapval journal.130ec32ae8944a client_
+ rbd journal status --image testrbdjournal3311723
+ fgrep 'positions=[]'
	[id=, commit_position=[positions=[]], state=connected]
++ grep -c 'event_type.*AioWrite'
++ rbd journal inspect --verbose 130ec32ae8944a
+ local count1=10
+ test 10 -eq 10
+ rbd journal export 130ec32ae8944a /tmp/rbd_journal3311723/journal.export
10 entries processed, 0 errors
++ stat -c %s /tmp/rbd_journal3311723/journal.export
+ local size=55600
+ test 55600 -gt 0
+ rbd export testrbdjournal3311723 /tmp/rbd_journal3311723/testrbdjournal3311723.export
Exporting image: 3% complete...Exporting image: 6% complete...Exporting image: 9% complete...Exporting image: 12% complete...Exporting image: 15% complete...Exporting image: 18% complete...Exporting image: 21% complete...Exporting image: 25% complete...Exporting image: 28% complete...Exporting image: 31% complete...Exporting image: 34% complete...Exporting image: 37% complete...Exporting image: 40% complete...Exporting image: 43% complete...Exporting image: 46% complete...Exporting image: 50% complete...Exporting image: 53% complete...Exporting image: 56% complete...Exporting image: 59% complete...Exporting image: 62% complete...Exporting image: 65% complete...Exporting image: 68% complete...Exporting image: 71% complete...Exporting image: 75% complete...Exporting image: 78% complete...Exporting image: 81% complete...Exporting image: 84% complete...Exporting image: 87% complete...Exporting image: 90% complete...Exporting image: 93% complete...Exporting image: 96% complete...Exporting image: 100% complete...done.
+ local image1=testrbdjournal33117231
+ rbd create --image-feature exclusive-lock --image-feature journaling --size 128 testrbdjournal33117231
++ xmlstarlet sel -t -v //image/journal
++ rbd info testrbdjournal33117231 --format=xml
+ journal1=130ee12ae8944a
+ save_commit_position 130ee12ae8944a
+ local journal=130ee12ae8944a
+ rados -p rbd getomapval journal.130ee12ae8944a client_ /tmp/rbd_journal3311723/130ee12ae8944a.client_.omap
Writing to /tmp/rbd_journal3311723/130ee12ae8944a.client_.omap
+ rbd journal import --dest testrbdjournal33117231 /tmp/rbd_journal3311723/journal.export
10 entries processed, 0 errors
Waiting for journal append to complete...
+ rbd snap create testrbdjournal33117231@test
+ restore_commit_position 130ee12ae8944a
+ local journal=130ee12ae8944a
+ rados -p rbd setomapval journal.130ee12ae8944a client_
+ rbd journal inspect --image testrbdjournal33117231 --verbose
+ awk '
      /AioWrite/          {w++}         # match: "event_type": "AioWrite",
      /SnapCreate/        {s++}         # match: "event_type": "SnapCreate",
      /OpFinish/          {f++}         # match: "event_type": "OpFinish",
      /entries inspected/ {t=$1; e=$4}  # match: 12 entries inspected, 0 errors
                          {print}       # for diagnostic
      END                 {
        if (w != 10 || s != 1 || f != 1 || t != 12 || e != 0) exit(1)
      }
    '
Entry: tag_id=1, commit_tid=1
{
    "event_type": "AioWrite",
    "offset": 120807424,
    "length": 4096
}
Entry: tag_id=1, commit_tid=2
{
    "event_type": "AioWrite",
    "offset": 120811520,
    "length": 4096
}
Entry: tag_id=1, commit_tid=3
{
    "event_type": "AioWrite",
    "offset": 120815616,
    "length": 4096
}
Entry: tag_id=1, commit_tid=4
{
    "event_type": "AioWrite",
    "offset": 120819712,
    "length": 4096
}
Entry: tag_id=1, commit_tid=5
{
    "event_type": "AioWrite",
    "offset": 120823808,
    "length": 4096
}
Entry: tag_id=1, commit_tid=6
{
    "event_type": "AioWrite",
    "offset": 120827904,
    "length": 4096
}
Entry: tag_id=1, commit_tid=7
{
    "event_type": "AioWrite",
    "offset": 120832000,
    "length": 4096
}
Entry: tag_id=1, commit_tid=8
{
    "event_type": "AioWrite",
    "offset": 120836096,
    "length": 4096
}
Entry: tag_id=1, commit_tid=9
{
    "event_type": "AioWrite",
    "offset": 120840192,
    "length": 4096
}
Entry: tag_id=1, commit_tid=10
{
    "event_type": "AioWrite",
    "offset": 120844288,
    "length": 4096
}
Entry: tag_id=1, commit_tid=11
{
    "event_type": "SnapCreate",
    "op_tid": 1,
    "snap_name": "test"
}
Entry: tag_id=1, commit_tid=12
{
    "event_type": "OpFinish",
    "op_tid": 1,
    "op_tid": 1,
    "result": 0
}
Summary:
  12 entries inspected, 0 errors
+ rbd export testrbdjournal33117231@test /tmp/rbd_journal3311723/testrbdjournal33117231.export
Exporting image: 3% complete...Exporting image: 6% complete...Exporting image: 9% complete...Exporting image: 12% complete...Exporting image: 15% complete...Exporting image: 18% complete...Exporting image: 21% complete...Exporting image: 25% complete...Exporting image: 28% complete...Exporting image: 31% complete...Exporting image: 34% complete...Exporting image: 37% complete...Exporting image: 40% complete...Exporting image: 43% complete...Exporting image: 46% complete...Exporting image: 50% complete...Exporting image: 53% complete...Exporting image: 56% complete...Exporting image: 59% complete...Exporting image: 62% complete...Exporting image: 65% complete...Exporting image: 68% complete...Exporting image: 71% complete...Exporting image: 75% complete...Exporting image: 78% complete...Exporting image: 81% complete...Exporting image: 84% complete...Exporting image: 87% complete...Exporting image: 90% complete...Exporting image: 93% complete...Exporting image: 96% complete...Exporting image: 100% complete...done.
+ cmp /tmp/rbd_journal3311723/testrbdjournal3311723.export /tmp/rbd_journal3311723/testrbdjournal33117231.export
+ rbd journal reset 130ec32ae8944a
+ expect_false grep event_type
+ set -x
+ grep event_type
+ rbd journal inspect --verbose 130ec32ae8944a
+ return 0
+ rbd snap purge testrbdjournal33117231
Removing all snapshots: 100% complete...Removing all snapshots: 100% complete...done.
+ rbd remove testrbdjournal33117231
Removing image: 3% complete...Removing image: 6% complete...Removing image: 9% complete...Removing image: 12% complete...Removing image: 15% complete...Removing image: 18% complete...Removing image: 21% complete...Removing image: 25% complete...Removing image: 28% complete...Removing image: 31% complete...Removing image: 34% complete...Removing image: 37% complete...Removing image: 40% complete...Removing image: 43% complete...Removing image: 46% complete...Removing image: 50% complete...Removing image: 53% complete...Removing image: 56% complete...Removing image: 59% complete...Removing image: 62% complete...Removing image: 65% complete...Removing image: 68% complete...Removing image: 71% complete...Removing image: 75% complete...Removing image: 78% complete...Removing image: 81% complete...Removing image: 84% complete...Removing image: 87% complete...Removing image: 90% complete...Removing image: 93% complete...Removing image: 96% complete...Removing image: 100% complete...done.
+ rbd remove testrbdjournal3311723
Removing image: 3% complete...Removing image: 6% complete...Removing image: 9% complete...Removing image: 12% complete...Removing image: 15% complete...Removing image: 18% complete...Removing image: 21% complete...Removing image: 25% complete...Removing image: 28% complete...Removing image: 31% complete...Removing image: 34% complete...Removing image: 37% complete...Removing image: 40% complete...Removing image: 43% complete...Removing image: 46% complete...Removing image: 50% complete...Removing image: 53% complete...Removing image: 56% complete...Removing image: 59% complete...Removing image: 62% complete...Removing image: 65% complete...Removing image: 68% complete...Removing image: 71% complete...Removing image: 75% complete...Removing image: 78% complete...Removing image: 81% complete...Removing image: 84% complete...Removing image: 87% complete...Removing image: 90% complete...Removing image: 93% complete...Removing image: 96% complete...Removing image: 100% complete...done.
+ set +x
-:1.3352: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_create
+ local image=testrbdcreate3311723
+ rbd create --image-feature exclusive-lock --image-feature journaling --journal-pool rbd --journal-object-size 20M --journal-splay-width 6 --size 256 testrbdcreate3311723
+ rbd_assert_eq testrbdcreate3311723 'journal info' //journal/order 25
+ local image=testrbdcreate3311723
+ local 'cmd=journal info'
+ local param=//journal/order
+ local expected_val=25
++ xmlstarlet sel -t -v //journal/order
++ rbd --format xml journal info --image testrbdcreate3311723
+ local val=25
+ test 25 = 25
+ rbd_assert_eq testrbdcreate3311723 'journal info' //journal/splay_width 6
+ local image=testrbdcreate3311723
+ local 'cmd=journal info'
+ local param=//journal/splay_width
+ local expected_val=6
++ xmlstarlet sel -t -v //journal/splay_width
++ rbd --format xml journal info --image testrbdcreate3311723
+ local val=6
+ test 6 = 6
+ rbd_assert_eq testrbdcreate3311723 'journal info' //journal/object_pool rbd
+ local image=testrbdcreate3311723
+ local 'cmd=journal info'
+ local param=//journal/object_pool
+ local expected_val=rbd
++ rbd --format xml journal info --image testrbdcreate3311723
++ xmlstarlet sel -t -v //journal/object_pool
+ local val=rbd
+ test rbd = rbd
+ rbd remove testrbdcreate3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ set +x
-:1.3391: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_copy
+ local src=testrbdcopys3311723
+ rbd create --size 256 testrbdcopys3311723
+ local image=testrbdcopy3311723
+ rbd copy --image-feature exclusive-lock --image-feature journaling --journal-pool rbd --journal-object-size 20M --journal-splay-width 6 testrbdcopys3311723 testrbdcopy3311723
Image copy: 1% complete...Image copy: 3% complete...Image copy: 4% complete...Image copy: 6% complete...Image copy: 7% complete...Image copy: 9% complete...Image copy: 10% complete...Image copy: 12% complete...Image copy: 14% complete...Image copy: 15% complete...Image copy: 17% complete...Image copy: 18% complete...Image copy: 20% complete...Image copy: 21% complete...Image copy: 23% complete...Image copy: 25% complete...Image copy: 26% complete...Image copy: 28% complete...Image copy: 29% complete...Image copy: 31% complete...Image copy: 32% complete...Image copy: 34% complete...Image copy: 35% complete...Image copy: 37% complete...Image copy: 39% complete...Image copy: 40% complete...Image copy: 42% complete...Image copy: 43% complete...Image copy: 45% complete...Image copy: 46% complete...Image copy: 48% complete...Image copy: 50% complete...Image copy: 51% complete...Image copy: 53% complete...Image copy: 54% complete...Image copy: 56% complete...Image copy: 57% complete...Image copy: 59% complete...Image copy: 60% complete...Image copy: 62% complete...Image copy: 64% complete...Image copy: 65% complete...Image copy: 67% complete...Image copy: 68% complete...Image copy: 70% complete...Image copy: 71% complete...Image copy: 73% complete...Image copy: 75% complete...Image copy: 76% complete...Image copy: 78% complete...Image copy: 79% complete...Image copy: 81% complete...Image copy: 82% complete...Image copy: 84% complete...Image copy: 85% complete...Image copy: 87% complete...Image copy: 89% complete...Image copy: 90% complete...Image copy: 92% complete...Image copy: 93% complete...Image copy: 95% complete...Image copy: 96% complete...Image copy: 98% complete...Image copy: 100% complete...Image copy: 100% complete...done.
+ rbd remove testrbdcopys3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ rbd_assert_eq testrbdcopy3311723 'journal info' //journal/order 25
+ local image=testrbdcopy3311723
+ local 'cmd=journal info'
+ local param=//journal/order
+ local expected_val=25
++ xmlstarlet sel -t -v //journal/order
++ rbd --format xml journal info --image testrbdcopy3311723
+ local val=25
+ test 25 = 25
+ rbd_assert_eq testrbdcopy3311723 'journal info' //journal/splay_width 6
+ local image=testrbdcopy3311723
+ local 'cmd=journal info'
+ local param=//journal/splay_width
+ local expected_val=6
++ xmlstarlet sel -t -v //journal/splay_width
++ rbd --format xml journal info --image testrbdcopy3311723
+ local val=6
+ test 6 = 6
+ rbd_assert_eq testrbdcopy3311723 'journal info' //journal/object_pool rbd
+ local image=testrbdcopy3311723
+ local 'cmd=journal info'
+ local param=//journal/object_pool
+ local expected_val=rbd
++ xmlstarlet sel -t -v //journal/object_pool
++ rbd --format xml journal info --image testrbdcopy3311723
+ local val=rbd
+ test rbd = rbd
+ rbd remove testrbdcopy3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ set +x
-:1.3392: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_clone
+ local parent=testrbdclonep3311723
+ rbd create --image-feature layering --size 256 testrbdclonep3311723
+ rbd snap create testrbdclonep3311723@snap
+ rbd snap protect testrbdclonep3311723@snap
+ local image=testrbdclone3311723
+ rbd clone --image-feature layering --image-feature exclusive-lock --image-feature journaling --journal-pool rbd --journal-object-size 20M --journal-splay-width 6 testrbdclonep3311723@snap testrbdclone3311723
+ rbd_assert_eq testrbdclone3311723 'journal info' //journal/order 25
+ local image=testrbdclone3311723
+ local 'cmd=journal info'
+ local param=//journal/order
+ local expected_val=25
++ xmlstarlet sel -t -v //journal/order
++ rbd --format xml journal info --image testrbdclone3311723
+ local val=25
+ test 25 = 25
+ rbd_assert_eq testrbdclone3311723 'journal info' //journal/splay_width 6
+ local image=testrbdclone3311723
+ local 'cmd=journal info'
+ local param=//journal/splay_width
+ local expected_val=6
++ xmlstarlet sel -t -v //journal/splay_width
++ rbd --format xml journal info --image testrbdclone3311723
+ local val=6
+ test 6 = 6
+ rbd_assert_eq testrbdclone3311723 'journal info' //journal/object_pool rbd
+ local image=testrbdclone3311723
+ local 'cmd=journal info'
+ local param=//journal/object_pool
+ local expected_val=rbd
++ xmlstarlet sel -t -v //journal/object_pool
++ rbd --format xml journal info --image testrbdclone3311723
+ local val=rbd
+ test rbd = rbd
+ rbd remove testrbdclone3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ rbd snap unprotect testrbdclonep3311723@snap
+ rbd snap purge testrbdclonep3311723
Removing all snapshots: 100% complete...Removing all snapshots: 100% complete...done.
+ rbd remove testrbdclonep3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ set +x
-:1.3391: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_import
+ local src=testrbdimports3311723
+ rbd create --size 256 testrbdimports3311723
+ rbd export testrbdimports3311723 /tmp/rbd_journal3311723/testrbdimports3311723.export
Exporting image: 1% complete...Exporting image: 3% complete...Exporting image: 4% complete...Exporting image: 6% complete...Exporting image: 7% complete...Exporting image: 9% complete...Exporting image: 10% complete...Exporting image: 12% complete...Exporting image: 14% complete...Exporting image: 15% complete...Exporting image: 17% complete...Exporting image: 18% complete...Exporting image: 20% complete...Exporting image: 21% complete...Exporting image: 23% complete...Exporting image: 25% complete...Exporting image: 26% complete...Exporting image: 28% complete...Exporting image: 29% complete...Exporting image: 31% complete...Exporting image: 32% complete...Exporting image: 34% complete...Exporting image: 35% complete...Exporting image: 37% complete...Exporting image: 39% complete...Exporting image: 40% complete...Exporting image: 42% complete...Exporting image: 43% complete...Exporting image: 45% complete...Exporting image: 46% complete...Exporting image: 48% complete...Exporting image: 50% complete...Exporting image: 51% complete...Exporting image: 53% complete...Exporting image: 54% complete...Exporting image: 56% complete...Exporting image: 57% complete...Exporting image: 59% complete...Exporting image: 60% complete...Exporting image: 62% complete...Exporting image: 64% complete...Exporting image: 65% complete...Exporting image: 67% complete...Exporting image: 68% complete...Exporting image: 70% complete...Exporting image: 71% complete...Exporting image: 73% complete...Exporting image: 75% complete...Exporting image: 76% complete...Exporting image: 78% complete...Exporting image: 79% complete...Exporting image: 81% complete...Exporting image: 82% complete...Exporting image: 84% complete...Exporting image: 85% complete...Exporting image: 87% complete...Exporting image: 89% complete...Exporting image: 90% complete...Exporting image: 92% complete...Exporting image: 93% complete...Exporting image: 95% complete...Exporting image: 96% complete...Exporting image: 98% complete...Exporting image: 100% complete...done.
+ rbd remove testrbdimports3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ local image=testrbdimport3311723
+ rbd import --image-feature exclusive-lock --image-feature journaling --journal-pool rbd --journal-object-size 20M --journal-splay-width 6 /tmp/rbd_journal3311723/testrbdimports3311723.export testrbdimport3311723
Importing image: 1% complete...Importing image: 3% complete...Importing image: 4% complete...Importing image: 6% complete...Importing image: 7% complete...Importing image: 9% complete...Importing image: 10% complete...Importing image: 12% complete...Importing image: 14% complete...Importing image: 15% complete...Importing image: 17% complete...Importing image: 18% complete...Importing image: 20% complete...Importing image: 21% complete...Importing image: 23% complete...Importing image: 25% complete...Importing image: 26% complete...Importing image: 28% complete...Importing image: 29% complete...Importing image: 31% complete...Importing image: 32% complete...Importing image: 34% complete...Importing image: 35% complete...Importing image: 37% complete...Importing image: 39% complete...Importing image: 40% complete...Importing image: 42% complete...Importing image: 43% complete...Importing image: 45% complete...Importing image: 46% complete...Importing image: 48% complete...Importing image: 50% complete...Importing image: 51% complete...Importing image: 53% complete...Importing image: 54% complete...Importing image: 56% complete...Importing image: 57% complete...Importing image: 59% complete...Importing image: 60% complete...Importing image: 62% complete...Importing image: 64% complete...Importing image: 65% complete...Importing image: 67% complete...Importing image: 68% complete...Importing image: 70% complete...Importing image: 71% complete...Importing image: 73% complete...Importing image: 75% complete...Importing image: 76% complete...Importing image: 78% complete...Importing image: 79% complete...Importing image: 81% complete...Importing image: 82% complete...Importing image: 84% complete...Importing image: 85% complete...Importing image: 87% complete...Importing image: 89% complete...Importing image: 90% complete...Importing image: 92% complete...Importing image: 93% complete...Importing image: 95% complete...Importing image: 96% complete...Importing image: 98% complete...Importing image: 100% complete...Importing image: 100% complete...done.
+ rbd_assert_eq testrbdimport3311723 'journal info' //journal/order 25
+ local image=testrbdimport3311723
+ local 'cmd=journal info'
+ local param=//journal/order
+ local expected_val=25
++ xmlstarlet sel -t -v //journal/order
++ rbd --format xml journal info --image testrbdimport3311723
+ local val=25
+ test 25 = 25
+ rbd_assert_eq testrbdimport3311723 'journal info' //journal/splay_width 6
+ local image=testrbdimport3311723
+ local 'cmd=journal info'
+ local param=//journal/splay_width
+ local expected_val=6
++ xmlstarlet sel -t -v //journal/splay_width
++ rbd --format xml journal info --image testrbdimport3311723
+ local val=6
+ test 6 = 6
+ rbd_assert_eq testrbdimport3311723 'journal info' //journal/object_pool rbd
+ local image=testrbdimport3311723
+ local 'cmd=journal info'
+ local param=//journal/object_pool
+ local expected_val=rbd
++ xmlstarlet sel -t -v //journal/object_pool
++ rbd --format xml journal info --image testrbdimport3311723
+ local val=rbd
+ test rbd = rbd
+ rbd remove testrbdimport3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ set +x
-:1.3389: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
+ test_rbd_feature
+ local image=testrbdfeature3311723
+ rbd create --image-feature exclusive-lock --size 256 testrbdfeature3311723
+ rbd feature enable testrbdfeature3311723 journaling --journal-pool rbd --journal-object-size 20M --journal-splay-width 6
+ rbd_assert_eq testrbdfeature3311723 'journal info' //journal/order 25
+ local image=testrbdfeature3311723
+ local 'cmd=journal info'
+ local param=//journal/order
+ local expected_val=25
++ xmlstarlet sel -t -v //journal/order
++ rbd --format xml journal info --image testrbdfeature3311723
+ local val=25
+ test 25 = 25
+ rbd_assert_eq testrbdfeature3311723 'journal info' //journal/splay_width 6
+ local image=testrbdfeature3311723
+ local 'cmd=journal info'
+ local param=//journal/splay_width
+ local expected_val=6
++ xmlstarlet sel -t -v //journal/splay_width
++ rbd --format xml journal info --image testrbdfeature3311723
+ local val=6
+ test 6 = 6
+ rbd_assert_eq testrbdfeature3311723 'journal info' //journal/object_pool rbd
+ local image=testrbdfeature3311723
+ local 'cmd=journal info'
+ local param=//journal/object_pool
+ local expected_val=rbd
++ xmlstarlet sel -t -v //journal/object_pool
++ rbd --format xml journal info --image testrbdfeature3311723
+ local val=rbd
+ test rbd = rbd
+ rbd remove testrbdfeature3311723
Removing image: 1% complete...Removing image: 3% complete...Removing image: 4% complete...Removing image: 6% complete...Removing image: 7% complete...Removing image: 9% complete...Removing image: 10% complete...Removing image: 12% complete...Removing image: 14% complete...Removing image: 15% complete...Removing image: 17% complete...Removing image: 18% complete...Removing image: 20% complete...Removing image: 21% complete...Removing image: 23% complete...Removing image: 25% complete...Removing image: 26% complete...Removing image: 28% complete...Removing image: 29% complete...Removing image: 31% complete...Removing image: 32% complete...Removing image: 34% complete...Removing image: 35% complete...Removing image: 37% complete...Removing image: 39% complete...Removing image: 40% complete...Removing image: 42% complete...Removing image: 43% complete...Removing image: 45% complete...Removing image: 46% complete...Removing image: 48% complete...Removing image: 50% complete...Removing image: 51% complete...Removing image: 53% complete...Removing image: 54% complete...Removing image: 56% complete...Removing image: 57% complete...Removing image: 59% complete...Removing image: 60% complete...Removing image: 62% complete...Removing image: 64% complete...Removing image: 65% complete...Removing image: 67% complete...Removing image: 68% complete...Removing image: 70% complete...Removing image: 71% complete...Removing image: 73% complete...Removing image: 75% complete...Removing image: 76% complete...Removing image: 78% complete...Removing image: 79% complete...Removing image: 81% complete...Removing image: 82% complete...Removing image: 84% complete...Removing image: 85% complete...Removing image: 87% complete...Removing image: 89% complete...Removing image: 90% complete...Removing image: 92% complete...Removing image: 93% complete...Removing image: 95% complete...Removing image: 96% complete...Removing image: 98% complete...Removing image: 100% complete...done.
+ set +x
-:1.3389: Namespace prefix up on standby is not defined
>0</rank><name>node1</name><status>up:active</status></mds></by_rank><up:standby
                                                                               ^
OK
